import React, { useState, useEffect } from 'react';
import { 
  Laptop, 
  Monitor, 
  Briefcase, 
  Palette, 
  Code2, 
  DollarSign, 
  ChevronRight, 
  CheckCircle2, 
  ArrowRight, 
  MessageSquare, 
  ShoppingCart, 
  RefreshCcw,
  Building2
} from 'lucide-react';

// --- DATOS Y LÓGICA DEL CUESTIONARIO ---

const QUESTIONS = [
  {
    id: 1,
    title: "¿Cuál es tu prioridad de movilidad?",
    description: "Para determinar si necesitas un portátil o un equipo de escritorio.",
    options: [
      { 
        id: 'laptop', 
        label: 'Movilidad Total', 
        sub: 'Trabajo desde casa, oficina y visitas a clientes.', 
        icon: <Laptop size={32} /> 
      },
      { 
        id: 'desktop', 
        label: 'Estación Fija', 
        sub: 'El equipo estará siempre en la oficina o mostrador.', 
        icon: <Monitor size={32} /> 
      }
    ]
  },
  {
    id: 2,
    title: "¿Qué tipo de trabajo realizará el equipo?",
    description: "Esto nos ayuda a calcular la potencia del procesador necesaria.",
    options: [
      { 
        id: 'admin', 
        label: 'Administrativo y Ventas', 
        sub: 'Correo, Excel, Web, CRM, Videollamadas.', 
        icon: <Briefcase size={32} /> 
      },
      { 
        id: 'creative', 
        label: 'Creativo y Marketing', 
        sub: 'Diseño gráfico ligero (Canva/Photoshop), Redes Sociales.', 
        icon: <Palette size={32} /> 
      },
      { 
        id: 'pro', 
        label: 'Producción Pesada', 
        sub: 'Edición de Video 4K, Desarrollo de Software, 3D.', 
        icon: <Code2 size={32} /> 
      }
    ]
  },
  {
    id: 3,
    title: "¿Cuál es tu presupuesto aproximado por equipo?",
    description: "Buscamos la mejor relación calidad-precio para tu PYME.",
    options: [
      { 
        id: 'budget', 
        label: 'Economía ante todo', 
        sub: 'Busco la opción más accesible y funcional.', 
        icon: <DollarSign size={24} /> 
      },
      { 
        id: 'value', 
        label: 'Balanceado', 
        sub: 'Inversión moderada para asegurar longevidad.', 
        icon: <DollarSign size={24} className="text-green-600" /> 
      },
      { 
        id: 'performance', 
        label: 'Máximo rendimiento', 
        sub: 'El presupuesto es secundario, necesito potencia.', 
        icon: <DollarSign size={24} className="text-purple-600" /> 
      }
    ]
  }
];

// Lógica de recomendación de productos
const PRODUCTS = {
  'macbook-air': {
    name: 'MacBook Air (M3)',
    tagline: 'Potencia ligera para el día a día.',
    description: 'Perfecto para tareas administrativas, ventas y gestión. Batería para todo el día y ultra portátil.',
    specs: ['Chip M3', 'Hasta 18h de batería', 'Pantalla Liquid Retina', 'Diseño sin ventilador (Silencioso)'],
    color: 'bg-blue-50'
  },
  'macbook-pro-14': {
    name: 'MacBook Pro 14"',
    tagline: 'El estándar para creadores en movimiento.',
    description: 'Ideal para diseño gráfico, edición de fotos y multitarea intensiva sin sacrificar movilidad.',
    specs: ['Chip M3 Pro / Max', 'Pantalla XDR ProMotion 120Hz', 'Puertos HDMI y SD', 'Ventilación activa'],
    color: 'bg-gray-100'
  },
  'macbook-pro-16': {
    name: 'MacBook Pro 16"',
    tagline: 'Una estación de trabajo portátil.',
    description: 'Para desarrolladores, editores de video y renderizado 3D que necesitan la pantalla más grande.',
    specs: ['Chip M3 Max', 'Pantalla masiva de 16"', 'Máxima disipación térmica', 'Batería de larga duración'],
    color: 'bg-gray-900 text-white'
  },
  'imac': {
    name: 'iMac 24"',
    tagline: 'Todo en uno. Todo color.',
    description: 'La mejor opción para recepciones, oficinas de diseño y espacios cara al público. Elegante y potente.',
    specs: ['Chip M3', 'Pantalla 4.5K Retina', 'Cámara 1080p integrada', 'Diseño ultra delgado'],
    color: 'bg-teal-50'
  },
  'mac-mini': {
    name: 'Mac mini',
    tagline: 'Más músculo. Más cerebro.',
    description: 'La opción más económica y versátil. Usa tus propios monitores y periféricos.',
    specs: ['Chip M2 o M2 Pro', 'Tamaño compacto', 'Gran conectividad', 'Excelente precio/rendimiento'],
    color: 'bg-gray-50'
  },
  'mac-studio': {
    name: 'Mac Studio',
    tagline: 'Una potencia descomunal.',
    description: 'Para estudios creativos profesionales que requieren máximo rendimiento sostenido.',
    specs: ['Chip M2 Max / Ultra', 'Puertos frontales y traseros', 'Soporta hasta 5 monitores', 'Silencioso'],
    color: 'bg-zinc-200'
  }
};

const getRecommendation = (answers) => {
  const { q1, q2, q3 } = answers; // q1: mobility, q2: usage, q3: budget

  if (q1 === 'laptop') {
    if (q2 === 'pro') return PRODUCTS['macbook-pro-16'];
    if (q2 === 'creative') return PRODUCTS['macbook-pro-14'];
    if (q2 === 'admin' && q3 === 'performance') return PRODUCTS['macbook-pro-14'];
    return PRODUCTS['macbook-air']; // Default admin/budget
  } else {
    // Desktop
    if (q2 === 'pro') return PRODUCTS['mac-studio'];
    if (q2 === 'creative' && q3 === 'budget') return PRODUCTS['mac-mini']; // Mini Pro logic implicit
    if (q2 === 'creative') return PRODUCTS['imac'];
    if (q2 === 'admin' && q3 === 'budget') return PRODUCTS['mac-mini'];
    return PRODUCTS['imac']; // Default general desktop
  }
};

// --- COMPONENTES UI ---

const Header = () => (
  <header className="w-full py-6 px-4 md:px-8 flex items-center justify-between bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-100">
    <div className="flex items-center gap-2">
      <div className="w-8 h-8 bg-black rounded-lg flex items-center justify-center text-white font-bold">
        <Building2 size={18} />
      </div>
      <span className="font-semibold text-lg tracking-tight text-gray-900">MacBusiness<span className="text-gray-400">Advisor</span></span>
    </div>
    <div className="text-xs md:text-sm font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
      Para PYMES
    </div>
  </header>
);

const ProgressBar = ({ current, total }) => {
  const progress = ((current + 1) / total) * 100;
  return (
    <div className="w-full h-1.5 bg-gray-100 mt-0">
      <div 
        className="h-full bg-blue-600 transition-all duration-500 ease-out" 
        style={{ width: `${progress}%` }}
      />
    </div>
  );
};

export default function MacSelectorApp() {
  const [step, setStep] = useState(0); // 0 = Intro, 1-3 = Questions, 4 = Loading, 5 = Result
  const [answers, setAnswers] = useState({});
  const [recommendation, setRecommendation] = useState(null);

  const handleStart = () => setStep(1);

  const handleAnswer = (questionId, optionId) => {
    setAnswers(prev => ({ ...prev, [`q${questionId}`]: optionId }));
    
    if (step < 3) {
      setStep(prev => prev + 1);
    } else {
      setStep(4); // Go to loading
    }
  };

  // Simulate analysis loading time
  useEffect(() => {
    if (step === 4) {
      const result = getRecommendation(answers);
      setRecommendation(result);
      const timer = setTimeout(() => {
        setStep(5);
      }, 1500);
      return () => clearTimeout(timer);
    }
  }, [step, answers]);

  const resetQuiz = () => {
    setAnswers({});
    setRecommendation(null);
    setStep(0);
  };

  // --- RENDERS ---

  // 1. Pantalla de Bienvenida
  if (step === 0) {
    return (
      <div className="min-h-screen bg-white text-gray-900 font-sans selection:bg-blue-100">
        <Header />
        <main className="max-w-4xl mx-auto px-6 py-20 text-center flex flex-col items-center">
          <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-50 text-blue-700 font-medium text-sm mb-6 animate-fade-in-up">
            <span className="relative flex h-2 w-2">
              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
              <span className="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
            </span>
            Asistente de compras inteligente
          </div>
          
          <h1 className="text-4xl md:text-6xl font-bold tracking-tight mb-6 bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent">
            Encuentra el equipo ideal <br/> para tu negocio.
          </h1>
          
          <p className="text-xl text-gray-500 max-w-2xl mb-10 leading-relaxed">
            Sabemos que cada pequeña empresa es única. Responde 3 preguntas simples y te recomendaremos el Mac perfecto para potenciar tu productividad y la de tu equipo.
          </p>
          
          <button 
            onClick={handleStart}
            className="group relative inline-flex items-center gap-3 px-8 py-4 bg-black text-white rounded-full text-lg font-medium transition-transform active:scale-95 hover:bg-gray-800 shadow-xl hover:shadow-2xl"
          >
            Comenzar ahora
            <ArrowRight className="group-hover:translate-x-1 transition-transform" />
          </button>
          
          <div className="mt-16 grid grid-cols-1 md:grid-cols-3 gap-8 text-left max-w-3xl">
            <div className="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <div className="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center mb-3 text-blue-600">
                <CheckCircle2 size={20} />
              </div>
              <h3 className="font-semibold mb-1">Ahorra tiempo</h3>
              <p className="text-sm text-gray-500">Sin tecnicismos complicados. Recomendaciones directas.</p>
            </div>
            <div className="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <div className="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center mb-3 text-blue-600">
                <DollarSign size={20} />
              </div>
              <h3 className="font-semibold mb-1">Optimiza inversión</h3>
              <p className="text-sm text-gray-500">Te sugerimos lo que necesitas, ni más ni menos.</p>
            </div>
            <div className="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <div className="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center mb-3 text-blue-600">
                <Building2 size={20} />
              </div>
              <h3 className="font-semibold mb-1">Enfoque B2B</h3>
              <p className="text-sm text-gray-500">Pensado para las necesidades reales de una PYME.</p>
            </div>
          </div>
        </main>
      </div>
    );
  }

  // 2. Pantallas de Preguntas
  if (step >= 1 && step <= 3) {
    const question = QUESTIONS[step - 1];
    return (
      <div className="min-h-screen bg-gray-50 flex flex-col font-sans">
        <Header />
        <ProgressBar current={step - 1} total={3} />
        
        <main className="flex-1 max-w-3xl mx-auto w-full px-6 py-12">
          <div className="mb-8">
            <span className="text-blue-600 font-semibold text-sm tracking-wider uppercase mb-2 block">Paso {step} de 3</span>
            <h2 className="text-3xl font-bold text-gray-900 mb-2">{question.title}</h2>
            <p className="text-gray-500 text-lg">{question.description}</p>
          </div>

          <div className="grid grid-cols-1 gap-4">
            {question.options.map((option) => (
              <button
                key={option.id}
                onClick={() => handleAnswer(step, option.id)}
                className="group flex items-center p-6 bg-white border-2 border-transparent rounded-2xl shadow-sm hover:border-blue-500 hover:shadow-md transition-all duration-200 text-left w-full"
              >
                <div className="flex-shrink-0 w-16 h-16 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors duration-200">
                  {option.icon}
                </div>
                <div className="ml-6 flex-1">
                  <h3 className="text-xl font-semibold text-gray-900 mb-1">{option.label}</h3>
                  <p className="text-gray-500 group-hover:text-gray-700">{option.sub}</p>
                </div>
                <div className="ml-4 opacity-0 group-hover:opacity-100 transition-opacity text-blue-600">
                  <ChevronRight size={24} />
                </div>
              </button>
            ))}
          </div>
        </main>
      </div>
    );
  }

  // 3. Pantalla de Carga
  if (step === 4) {
    return (
      <div className="min-h-screen bg-white flex flex-col items-center justify-center font-sans">
        <div className="w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-6"></div>
        <h2 className="text-2xl font-bold text-gray-900 mb-2">Analizando tus necesidades...</h2>
        <p className="text-gray-500">Buscando la mejor configuración para tu empresa.</p>
      </div>
    );
  }

  // 4. Pantalla de Resultados
  if (step === 5 && recommendation) {
    return (
      <div className="min-h-screen bg-gray-50 font-sans">
        <Header />
        
        <main className="max-w-5xl mx-auto px-6 py-12">
          <div className="text-center mb-12">
            <div className="inline-block px-4 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold mb-4">
              ¡Hemos encontrado tu match!
            </div>
            <h2 className="text-4xl font-bold text-gray-900">La mejor elección para tu negocio</h2>
          </div>

          <div className="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100 flex flex-col md:flex-row">
            {/* Columna Izquierda: Visual y Nombre */}
            <div className={`md:w-5/12 p-8 md:p-12 flex flex-col items-center justify-center text-center ${recommendation.color}`}>
              {/* Placeholder de imagen de producto */}
              <div className="w-64 h-48 bg-white/40 backdrop-blur-sm rounded-xl shadow-inner flex items-center justify-center mb-6">
                 {/* Icono grande como fallback de imagen */}
                 {answers.q1 === 'laptop' ? <Laptop size={80} className="text-gray-800/50" /> : <Monitor size={80} className="text-gray-800/50" />}
              </div>
              <h3 className="text-3xl font-bold text-gray-900 mb-2">{recommendation.name}</h3>
              <p className="text-lg font-medium opacity-80">{recommendation.tagline}</p>
            </div>

            {/* Columna Derecha: Detalles y CTA */}
            <div className="md:w-7/12 p-8 md:p-12 flex flex-col justify-center">
              <p className="text-gray-600 text-lg mb-8 leading-relaxed">
                {recommendation.description}
              </p>

              <div className="mb-8">
                <h4 className="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4">Especificaciones Clave</h4>
                <ul className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  {recommendation.specs.map((spec, index) => (
                    <li key={index} className="flex items-center text-gray-700">
                      <CheckCircle2 size={18} className="text-blue-500 mr-2 flex-shrink-0" />
                      {spec}
                    </li>
                  ))}
                </ul>
              </div>

              <div className="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-100">
                <button className="flex-1 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-xl font-semibold transition-colors shadow-lg shadow-blue-200">
                  <ShoppingCart size={20} />
                  Configurar y Comprar
                </button>
                <button className="flex-1 flex items-center justify-center gap-2 bg-white border-2 border-gray-200 hover:border-gray-900 text-gray-900 px-6 py-4 rounded-xl font-semibold transition-all">
                  <MessageSquare size={20} />
                  Hablar con Asesor B2B
                </button>
              </div>
            </div>
          </div>

          <div className="mt-12 text-center">
            <button 
              onClick={resetQuiz}
              className="inline-flex items-center gap-2 text-gray-500 hover:text-gray-900 transition-colors"
            >
              <RefreshCcw size={16} />
              Empezar de nuevo
            </button>
          </div>
        </main>
      </div>
    );
  }

  return null;
}

